<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz API UI</title>
</head>
<body>
    <form id="formCreate" onsubmit="sendQuestion()">
        <b>Add Question:</b>
        <div id="divQuestion">
            Enter your question
            <br>
            <input type="text" id="question">
        </div>
        <br>
        <br>
        <div id="divAnswers">
            Enter your answers
            <br>
            <input type="text" id="answer1">  
            <br>
            <input type="text" id="answer2">  
            <br>
            <input type="text" id="answer3">  
            <br>
            <input type="text" id="answer4">  
            <br>
        </div>
        <br>
        <br>
        <button type="submit">Submit Question</button>
        <br>
        <br>
    </form>
    <form id="formDelete" onsubmit="removeQuestion()">
        <div id="questions">
            <b>Existing Questions:</b>
            <br>
            <button type="submit">Delete Selected</button>
        </div>
    </form>

    <!-- this script is specifically for a feathersjs client -->
    <script src="https://unpkg.com/@feathersjs/client@^4.3.0/dist/feathers.js"></script>
    <!-- socket.io needs to be on front and back end for complete connection  -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.0.4/socket.io.js"></script>
    
    <!-- CRUD functionality for quiz questions -->
    <script>
        // Socket.io setup, the api service is on port 3030 under the name ideas
        // you can access the ideas service on this port using http://127.0.0.1:3030/ideas
        const socket = io('http://localhost:3030');

        // Init feathers app, it will be referred to as app
        const app = feathers();

        // Register socket.io to talk to the server
        app.configure(feathers.socketio(socket));



        // FUNCTION: sendQuestion()
        // PURPOSE:
        //  An question has been entered into the html form and the user has pressed the submit button.
        //  This function is called to collect the input and send it to the server.
        // PARAMETERS:
        //  e - an Event triggered by user action
        // RETURN: void

        async function sendQuestion(e) {
            // get the user info
            const question = document.getElementById('question');
            const answer1 = document.getElementById('answer1');
            const answer2 = document.getElementById('answer2');
            const answer3 = document.getElementById('answer3');
            const answer4 = document.getElementById('answer4');

            let answers = [answer1.value, answer2.value, answer3.value, answer4.value];

            // Create new question
            app.service('questions').create({
                question: question.value,
                answers: answers
            });

            // Clear inputs since the user submitted what they entered and can start a new entry
            question.value = '';
            answer1.value = '';
            answer2.value = '';
            answer3.value = '';
            answer4.value = '';
        }



        // FUNCTION: removeQuestion()
        // PURPOSE:
        //  An question has been entered into the html form and the user has pressed the submit button.
        //  This function is called to collect the input and send it to the server.
        // PARAMETERS:
        //  e - an Event triggered by user action
        // RETURN: void

        async function removeQuestion() {
            
            const collection = document.getElementById("questions").children;
            console.log(collection);
            for (let item of collection) {
                if (item.id.includes("question") && item.checked) {
                    // Delete a question
                    console.log(item.id.match(/\d+/).toString());
                    app.service('questions').remove(item.id.match(/\d+/).toString());
                }
            }

            
        }



        // FUNCTION: renderQuestion()
        // PURPOSE:
        //  Each question in the questions array will be displayed on the website.
        //  This function receives a single question and appends html to the appropriate div.
        // PARAMETERS:
        //  idea - an Event triggered by user action
        // RETURN: void
        function renderQuestion(question) {
            // get the ideas div to append to and appendthe html
            document.getElementById('questions').innerHTML += 
            `
            <br>
            <br>
            <input id="question${question.id}" type="checkbox">
                <p>${question.question}</p>
                <ul>
                    <li>${question.answers[0]}</li>
                    <li>${question.answers[1]}</li>
                    <li>${question.answers[2]}</li>
                    <li>${question.answers[3]}</li>
                </ul>
            </input>
            `;
        }



        // FUNCTION: init()
        // PURPOSE:
        //  This function 
        // PARAMETERS: void
        // RETURN: void
        async function init() {
            // the 
            const questions = await app.service('questions').find();

            // Add existing ideas to list
            questions.forEach(renderQuestion);

            // Add idea in realtime
            app.service('questions').on('created', renderQuestion);
        }

        init();

        </script>

</body>
</html>